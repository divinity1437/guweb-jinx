new Vue({delimiters:["<%","%>"],el:'#beatmaps',data(){return{maps:[],request:false,query:"",prevQuery:null,load:true,advSettings:false,mode:-1,category:0,page:1,timer:null,advanced:false,latest:0,}},watch:{mode(){this.latest=0;this.searchBeatmap(this.query);},category(){this.latest=0;this.searchBeatmap(this.query);},query(q){var vm=this;clearTimeout(this.timer);this.timer=setTimeout(function(){vm.latest=0;vm.searchBeatmap(vm.query);},300);}},created(){var vm=this;$(function(){$(window).scroll(function(){if(($(window).scrollTop()+$(window).height()>$(document).height()-300)&&vm.load==false&&vm.maps.length>=vm.page*22){vm.searchBeatmap(vm.query,vm.page+1,true);}});vm.searchBeatmap();});},methods:{searchBeatmap:function(query="",page=1,append=false){var audioElement=window.audioElement;if(audioElement){audioElement.pause();audioElement.currentTime=0;audioElement=null;}
var vm=this;this.page=page;this.load=true;this.$axios.get("https://api.gatari.pw/beatmaps/search?q="+query,{params:{p:this.page,m:this.mode,r:this.category,es:this.advanced?1:0,from:this.latest}}).then(function(response){if(append)
vm.maps=vm.maps.concat(response.data.result);else
vm.maps=response.data.result;if(response.data.latest){console.log("nigger")
vm.latest=response.data.latest;}
vm.load=false;vm.prevQuery=query;$('.gatari-icon').tooltip('dispose');setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200);});}}});